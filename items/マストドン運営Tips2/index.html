
<h1>
<span id="tips一覧" class="fragment"></span><a href="#tips%E4%B8%80%E8%A6%A7"><i class="fa fa-link"></i></a>Tips一覧</h1>

<p>運営に有用かもしれない情報を箇条書していきます。</p>

<ul>
<li>.env.productionの設定をいじればDockerからRailsのみ取り出して運用することもできる。Docker内で動かしているPostgreSQLに接続することもできるし、その逆も可能。</li>
<li>Nginxで<code>proxy_set_header Accept-Encoding "";</code>と設定しなければRails側で圧縮してくるので、Brotli圧縮はできない。</li>
<li>固定IPが利用できないサーバではDDClientを用いて動的にDNS設定を変更すると良い。</li>
<li>マストドンはWebSocketを用いる。websocketを通さないよう設定できるCDN(Cloudflareとか)があるので、注意が必要。</li>
<li>連合タイムラインには最初に接続できないとその不具合を直してもうまくつながらない。</li>
<li>Windowsでプログラミングしてコードを変えるときは改行に注意。</li>
<li>URL短縮を自前で用意すると良いかもしれない。URLは長いと書けないし、既存の短縮は信頼されていない。ただし、コードを公開すること。</li>
<li>くれぐれもセキュリティには注意すること。直接サーバのIPアドレスを晒してはならない。何らかの手段で隠蔽すること。</li>
<li>フルHTTPSにできないのであればおそらく立ち上げないほうが良い。</li>
<li>Webの最初のテーマは暗いのでいじったほうが良い。</li>
<li>ページと対応するHamlファイル。app/views/以下にある。</li>
</ul>

<table>
<thead>
<tr>
<th style="text-align: left">ページ</th>
<th style="text-align: left">Haml</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">/about/more</td>
<td style="text-align: left">/about/more.html.haml</td>
</tr>
<tr>
<td style="text-align: left">/about</td>
<td style="text-align: left">/about/show.html.haml</td>
</tr>
<tr>
<td style="text-align: left">/auth/edit</td>
<td style="text-align: left">/auth/registrations/edit.html.haml</td>
</tr>
<tr>
<td style="text-align: left">/web/getting-started</td>
<td style="text-align: left">/home/index.html.haml</td>
</tr>
<tr>
<td style="text-align: left">/oauth/authorized_applications</td>
<td style="text-align: left">/oauth/authorized_applications/index.html.haml</td>
</tr>
<tr>
<td style="text-align: left">/settings/export</td>
<td style="text-align: left">/settings/exports/show.html.haml</td>
</tr>
<tr>
<td style="text-align: left">/settings/follower_domains</td>
<td style="text-align: left">/settings/follower_domains/show.html.haml</td>
</tr>
<tr>
<td style="text-align: left">/settings/import</td>
<td style="text-align: left">/settings/imports/show.html.haml</td>
</tr>
<tr>
<td style="text-align: left">/settings/preferences</td>
<td style="text-align: left">/settings/preferences/show.html.haml</td>
</tr>
<tr>
<td style="text-align: left">/settings/profile</td>
<td style="text-align: left">/settings/profiles/show.html.haml</td>
</tr>
<tr>
<td style="text-align: left">/settings/two_factor_authentication</td>
<td style="text-align: left">/settings/two_factor_authentications/show.html.haml</td>
</tr>
</tbody>
</table>

<ul>
<li>ローカルでページを閲覧するときはcurlではなくwgetを使う。<code>wget -qO- --no-check-certificate http://127.0.0.1:3000</code>でローカルのトップページを出力できる。これの何が良いかというと特定のページの複雑な変更が可能になる。Rubyのコードを見ずともAPIを書き換えてしまえる。</li>
<li>マストドンの<code>mastodon-web</code>サービスは再起動にある程度時間がかかるが､<code>kill -SIGUSR2 (pumaのPID)</code>すると接続したまま変更を読み込める｡ </li>
<li>mastodon-webのところに<code>ExecReload=/bin/kill $MAINPID</code>と書き込めば<code>systemctl reload mastodon-web</code>が使えるようになる｡</li>
</ul>
