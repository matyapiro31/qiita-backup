#Let's Encryptとは
誰もが無料で簡単にサーバ証明書を手に入れ､設定できるようにしようというコンセプトのプロジェクトです｡
Public Betaが終了し､今年4月に正式にサービスが開始されました｡
自動設定をしてくれるクライアントがあり､様々なWebサーバに対応しています｡
正式リリースに伴い､クライアント名も`certbot`という名前に変わりました｡
今回はApache2 + Ubuntu 14.04(Raspberry Pi)でやってみました｡

#導入
certbotの導入には`git`を使えと書いてあるサイトもありますが､やめておいたほうがいいです｡特にUbuntuやDebianだと`git`のインストールは大量の依存関係を引っ張ってくるので､サーバに負担がかかります｡
ここはシンプルにcertbotのgithubリポジトリ(https://github.com/certbot/certbot)からwgetなどでダウンロードするのが無難です｡
必要なのは**certbot-auto**というスクリプトだけなので､
`wget https://raw.githubusercontent.com/certbot/certbot/master/certbot-auto`
さらにダウンロードしたファイルに実行権限を付けます｡
`chmod +x ./certbot-auto`
実行｡ルート権限を使用する必要があります｡
(2016年9月3日追記: -d オプションを使用することによって複数ドメインに対応することができます。ただし、ワイルドカードドメインは今の所対応していません。)
`sudo ./certbot-auto --apache`
実行すると**`Installing Python packages...`**というメッセージが出てしばらく止まりますが､pipでpythonのパッケージをインストールしているだけなので､問題無いです｡
こんな画面が出るので､**Yes**

```
   +――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――+
   | No names were found in your configuration files.                     |
   | You should specify ServerNames in your config files in order to      |
   | allow for accurate installation of your certificate.                 |
   | If you do use the default vhost, you may specify the name manually.  |
   | Would you like to continue?                                          |
   |                                                                      |
   |                                                                      |
   |                                                                      |
   |                                                                      |
   |                                                                      |
   |                                                                      |
   |                                                                      |
   |                                                                      |
   |                                                                      |
   |                                                                      |
   |                                                                      |
   +――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――+
   |                     < Yes >           < No  >                        |
   +――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――+
```
さらにドメイン名を入力｡

```
   +――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――+
   | Please enter in your domain name(s) (comma and/or space separated)   |
   | +――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――+ |
   | |example.com                                                       | |
   | +――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――+ |
   +――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――+
   |                     <  OK  >           <Cancel>                      |
   +――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――+
```
既にドメイン名を設定していた場合､上のメッセージが飛んでこのメッセージが出る｡

```
   +――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――+
   | Which names would you like to activate HTTPS for?                    |
   | +――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――+ |
   | |                     [*] www.example.com                          | |
   | |                                                                  | |
   | |                                                                  | |
   | |                                                                  | |
   | |                                                                  | |
   | |                                                                  | |
   | |                                                                  | |
   | +――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――+ |
   |                                                                      |
   |                                                                      |
   |                                                                      |
   |                                                                      |
   |                                                                      |
   |                                                                      |
   +――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――+
   |                     <  OK  >           <Cancel>                      |
   +――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――+
```
常にSSL/TLSを使うか､通常のHTTPも使えるようにするか選択する｡

```
   +――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――+
   | Please choose whether HTTPS access is required or optional.          |
   | +――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――+ |
   | |    Easy    Allow both HTTP and HTTPS access to these sites       | |
   | |    Secure  Make all requests redirect to secure HTTPS access     | |
   | |                                                                  | |
   | |                                                                  | |
   | |                                                                  | |
   | |                                                                  | |
   | |                                                                  | |
   | |                                                                  | |
   | |                                                                  | |
   | |                                                                  | |
   | |                                                                  | |
   | |                                                                  | |
   | |                                                                  | |
   | +――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――+ |
   +――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――+
   |                     <  OK  >           <Cancel>                      |
   +――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――+
```
成功するとこのメッセージが表示されます｡

```
   +――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――+
   | Congratulations! You have successfully enabled                       |
   | https://www.example.com                                              |
   |                                                                      |
   | You should test your configuration at:                               |
   | https://www.ssllabs.com/ssltest/analyze.html?d=www.example.com       |
   |                                                                      |
   |                                                                      |
   +――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――+
   |                               <  OK  >                               |
   +――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――+
```
最期に`Your cert will expire on YEAR-MONTH-DATE.`という文でいつ証明書の有効期限が切れるのか教えてくれるので､メモしておこう｡

#証明書の更新
更新だけであればこのコマンドを使う｡

`./certbot-auto --apache certonly`
##追記
上の手順ではダメだったので、一からインストールし直し、設定を再インストールしたうえで、
`sudo service apache2 reload`
`sudo systemctl daemon-reload`
`sudo service apache2 restart`
を実行する。
#アンインストール
このプログラムは`~/.local/share/letsencrypt`にPythonのモジュールをインストールするのでこれも削除したほうがいいでしょう｡
#補足
2016年8月27日の時点での情報です｡多分すぐに色々変わると思うので､最新の情報はLet's EncryptのWebサイトにて確認してください｡

